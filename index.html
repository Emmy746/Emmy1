<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="icon" type="image/png" sizes="32x32" href="./assets/images/favicon-32x32.png">
  <title>Newsletter Sign-Up | Meta Pixel Practice</title>
  <link rel="stylesheet" href="style.css">

  <script>
    !function(f,b,e,v,n,t,s)
    {if(f.fbq)return;n=f.fbq=function(){n.callMethod?
    n.callMethod.apply(n,arguments):n.queue.push(arguments)};
    if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
    n.queue=[];t=b.createElement(e);t.async=!0;
    t.src=v;s=b.getElementsByTagName(e)[0];
    s.parentNode.insertBefore(t,s)}(window, document,'script',
    'https://connect.facebook.net/en_US/fbevents.js');
    fbq('init', '33193166620329142');
    fbq('track', 'PageView');
  </script>
</head>

<body>
  <main class="whole-page">
    <section id="main-area">
      <div class="text-area">
        <h1>Stay updated!</h1>
        <p>Join 60,000+ product managers receiving monthly updates on:</p>
        <ul>
          <li>Product discovery and building what matters</li>
          <li>Measuring to ensure updates are a success</li>
        </ul>
      </div>

      <form id="newsletterForm" class="input-area">
        <p>Email address</p>
        <input type="email" id="emailInput" placeholder="email@company.com" required>
        <p id="errorMessage" class="error-message"></p>
        <button type="submit" id="submitBtn">Subscribe to monthly newsletter</button>
      </form>
    </section>
  </main>

  <div id="successMessage" class="success-message hidden">
    <div class="success-content">
      <h2>Thanks for subscribing!</h2>
      <p>A confirmation email has been sent to <span id="emailDisplay"></span></p>
      <button id="dismissBtn">Dismiss message</button>
    </div>
  </div>

  <script>
    const newsletterForm = document.getElementById('newsletterForm');
    const emailInput = document.getElementById('emailInput');
    const successMessage = document.getElementById('successMessage');
    const emailDisplay = document.getElementById('emailDisplay');

    newsletterForm.addEventListener('submit', async function(e) {
      e.preventDefault();
      const emailValue = emailInput.value;

      // 1. ATTEMPT TO SEND TO RENDER
      try {
        // Change this URL once your Render service is live!
        const response = await fetch('https://meta-pixel-test-backend-side.onrender.com//submit-lead', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ email: emailValue })
        });

        if (response.ok) {
          // 2. FIRE THE PIXEL ONLY ON SUCCESS
          fbq('track', 'Lead', {
            content_name: 'Newsletter Signup',
            status: 'success'
          }, { em: emailValue });

          // 3. SHOW UI SUCCESS
          emailDisplay.innerText = emailValue;
          successMessage.classList.remove('hidden');
          console.log('Backend received lead & Pixel fired!');
        }
      } catch (error) {
        console.error('Backend offline. Firing Pixel anyway for practice...');
        // Fallback for testing if your backend isn't up yet
        fbq('track', 'Lead', { status: 'fallback_fire' });
        successMessage.classList.remove('hidden');
      }
    });
  </script>
</body>
</html>
